generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Modelo baseado no esquema recomendado para NextAuth + Prisma
model Account {
  id                 String    @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?   @db.Text
  access_token       String?   @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?   @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(uuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]
  profile       Usuario?  // Perfil do usuário (opcional)
  propriedades  Propriedade[] // Propriedades do usuário
}

model Usuario {
  id                String   @id @default(uuid())
  userId            String   @unique // Relacionamento 1:1 com User
  fullName          String?  // Nome completo editável
  birthDate         DateTime? // Data de nascimento
  cpf               String?  @unique // CPF único
  whatsapp          String?  // Número de WhatsApp (opcional)
  whatsappCountryCode String? @default("55") // Código DDI do país (padrão Brasil)
  whatsappConsent   Boolean  @default(false) // Consentimento para comunicações
  slug              String?  @unique // Identificador único para URLs (slug)
  slugChangeCount   Int      @default(0) // Contador de alterações do slug (máx 5)
  slugHistory       SlugHistory[] // Histórico de alterações do slug
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SlugHistory {
  id        String   @id @default(uuid())
  userId    String   // ID do usuário (Usuario.id)
  oldSlug   String?  // Slug anterior (null se era o primeiro)
  newSlug   String   // Novo slug
  changedAt DateTime @default(now())

  usuario Usuario @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Propriedade {
  id          String   @id @default(uuid())
  nomePropriedade String   // Nome da propriedade
  tipo        String?  // Tipo: fazenda, sítio, chácara, etc. (opcional)
  localidade String?  // Localidade (endereço ou coordenadas)
  tamanho     Float?   // Tamanho em hectares
  estado      String?  // Sigla do estado (UF)
  cidade      String?  // Nome da cidade
  latitude    Float?   // Latitude GPS
  longitude   Float?   // Longitude GPS
  proprietarioId String // ID do proprietário (User)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  proprietario User @relation(fields: [proprietarioId], references: [id], onDelete: Cascade)
  rebanhos     Rebanho[]
}

model Rebanho {
  id             String      @id @default(uuid())
  nomeRebanho    String
  tipo           String      // Bovino, Ovino, Caprino, Suíno, Equino
  raca           String?     // Raça do rebanho (obrigatório para caprinos)
  quantidade     Int
  propriedadeId  String
  propriedade    Propriedade @relation(fields: [propriedadeId], references: [id], onDelete: Cascade)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  deletedAt      DateTime?   // Soft delete

  animais        Animal[]
}

model Animal {
  id                  String      @id @default(uuid())
  numeroIdentificacao String      // Número único de identificação (brinco, registro, etc.)
  nome                String?     // Nome do animal (opcional)
  raca                String?     // Raça do animal
  dataNascimento      DateTime?   // Data de nascimento
  sexo                String?     // Macho, Fêmea
  pesoAoNascer        Float?      // Peso ao nascer em kg
  pesoAtual           Float?      // Peso atual em kg
  rebanhoId           String
  rebanho             Rebanho     @relation(fields: [rebanhoId], references: [id], onDelete: Cascade)
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  deletedAt           DateTime?   // Soft delete - quando não é null, o animal está excluído
  vendido             Boolean     @default(false) // Indica se o animal foi vendido
  emailComprador      String?     // Email do comprador quando vendido
  dataVenda           DateTime?   // Data da venda

  @@unique([rebanhoId, numeroIdentificacao])
}

model RacaCaracteristicas {
  id                        String  @id @default(uuid())
  tipo                      String  // Tipo do animal (Caprino, etc.)
  raca                      String  // Nome da raça
  origem                    String? // Origem da raça
  pesoNascer                Float?  // Peso médio ao nascer em kg
  peso10Meses               Float?  // Peso médio aos 10 meses em kg
  pesoMachoAdulto           Float?  // Peso médio do macho adulto em kg
  pesoFemeaAdulta           Float?  // Peso médio da fêmea adulta em kg
  
  // Novos campos para informações detalhadas da raça
  maturidadeSexual          Int?    // Maturidade sexual em meses
  femeaTemLeite             Boolean @default(true) // Se a fêmea possui leite suficiente para alimentar cria
  periodoGestacao           Int?    // Período de gestação em dias
  quantidadeCabritosParto   Float?  // Quantidade média de cabritos por parto
  abatePrecoceDias          Int?    // Dias para abate precoce (carne premium)
  abateConvencionalDias     Int?    // Dias para abate convencional
  abateTardioDiasMin        Int?    // Dias mínimos para abate tardio
  abateTardioDiasMax        Int?    // Dias máximos para abate tardio
  pelagemCouro              String? // Tipo de pelagem do couro (curto, longo, etc.)
  maxFemeasPorMacho         Int?    // Máximo de fêmeas por macho
  femeasPorMachoIdeal       Int?    // Número ideal de fêmeas por macho
  ganhoPesoDiaGramas        Float?  // Ganho aproximado de peso por dia em gramas
  percentualGorduraCarne    String? // Percentual de gordura da carne
  indiceColesterol          String? // Índice de colesterol (baixo, médio, alto)
  indiceGorduraSaturada     String? // Índice de gordura saturada
  indiceCalorias            String? // Índice de calorias
  carneMacia                Boolean @default(true) // Se a carne é macia
  carneSaborosa             Boolean @default(true) // Se a carne é saborosa
  carneSucculenta           Boolean @default(true) // Se a carne é suculenta

  @@unique([tipo, raca])
}
